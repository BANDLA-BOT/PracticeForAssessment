"use strict";var express=require("express"),mongoose=require("mongoose"),cors=require("cors"),multer=require("multer"),bodyParser=require("body-parser"),jwt=require("jsonwebtoken"),User=require("./models/User.js"),app=express();app.use(cors()),app.use(bodyParser.urlencoded({extended:!0})),app.use(express.json()),app.use(express.static("public")),mongoose.connect("mongodb://localhost:27017/Profile").then(function(){console.log("Connected to DB")}).catch(function(e){console.log(e)});var storage=multer.diskStorage({destination:function(e,r,s){s(null,"public/profilePic")},filename:function(e,r,s){s(null,Date.now()+"-"+r.originalname)}}),upload=multer({storage:storage});app.post("/register",upload.single("profilepic"),function(r,s){var o,n,t,a,i,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:try{o=r.body,n=o.email,t=o.username,a=o.password,i=r.file.filename,u=User.create({username:t,email:n,password:a,profilepic:i}),s.status(201).send({success:!0,user:u})}catch(e){s.status(500).json({message:!0,error:e})}case 1:case"end":return e.stop()}})}),app.use("/login",function(r,s){var o,n,t,a,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.body,n=o.email,t=o.password,console.log(t),console.log(n),e.prev=3,e.next=6,regeneratorRuntime.awrap(User.find(n));case 6:a=e.sent,console.log(a),console.log(a.password),a?a.password===t&&(i=jwt.sign({email:n},"jwt-secret-key-token",{expiresIn:"1m"}),console.log(i),s.json({success:"Logged in successfully",token:i,user:a})):s.json({message:"Error while log in "}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),console.log(e.t0);case 15:case"end":return e.stop()}},null,null,[[3,12]])});var verify=function(s,o,n){var e=s.headers.authorization&&s.headers.authorization.split(" ")[1];if(!e)return o.status(401).json({error:"No token provided"});jwt.verify(e,jwt-secret-key-e,function(e,r){if(e)return o.status(401).json({error:"Unauthorized"});s.user=r,n()})};app.get("/getuser",verify,function(e,r){var s=e.user;r.json({message:"verified",user:s})}),app.listen(8e3,function(){console.log("Server is running on 8000")});
//# sourceMappingURL=server.min.js.map
